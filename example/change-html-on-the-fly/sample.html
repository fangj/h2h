<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Html2Html Sample</title>
	<script src="js/jquery-1.10.2.js"></script>
	<script src="js/template_engine/handlebars.js" ></script>
	<script src="js/jquery.xdomainajax.js"></script>
	<script src="html2html.js"></script>
</head>
<body>

<div id="html-new" />

<script type="text/javascript">
	var handlebars_adapter=function(data,template){
		var compiled_template = Handlebars.compile(template);
		var html    = compiled_template(data);
		return html;
	};
	var wait = function(callbacks, done) {
	   var counter = callbacks.length;
	   var next = function() {
	      if(--counter == 0) {
	         done();
	      }
	   };
	   for(var i = 0; i < callbacks.length; i++) {
	      callbacks[i](next);
	   }
	};
	function download(link,results){
		var a = function (next) {
		   jQuery.get(link, function(res){
		   		if(res.responseText){
		   			results[link]=res.responseText;	
		   		}else{
		   			results[link]=res;
		   		}
	        	next();
	    	});
	  	};
	  	return a;
  	};
  	function downloadLinks(links,results,done){
  		var downloaders=[];
  		for (var i = 0; i < links.length; i++) {
  			var downloader=download(links[i],results);
  			downloaders.push(downloader);
  		};
  		wait(downloaders,done);
  	};
</script>

<script >

links=["http://www.bbc.co.uk/news/","mapping-rules/rule1.json","template/template1.html"];
results={};
downloadLinks(links,results,done);
function done(){
	 html_old=results["http://www.bbc.co.uk/news/"];
	 mapping_rules=results["mapping-rules/rule1.json"];	 
	 template   = results["template/template1.html"];
	 data=h2h.html2data(html_old,mapping_rules);
	 html_new=h2h.data2html(data,template,handlebars_adapter);
	$("#html-new").html(html_new);
}
</script>

</body>
</html>